{% extends 'base.html' %}
{% block content %}
<script type="text/javascript">
  var csrf_token = "{{ csrf_token() }}";
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
        xhr.setRequestHeader("X-CSRFToken", csrf_token);
      }
    }
  });
</script>

<!-- MODAL-->
<div id="invite-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <button label="close" id="close-button" type="button" class="close" data-dismiss="modal">&times;</button>
      <div class="model-header">
        <h4 class="modal-heading">Invite New User</h4>
      </div>
      <div class="modal-body">
        <div>
          <form class="invite-modal-form" action="#">
            <div class="form-group">
              <input id="invite-name" label="Name" name="name" type="text" placeholder="Name"></input>
              <input id="invite-email" label="Email" name="email" type="text" placeholder="Email Address"></input>
            </div>
            <button label="submit" class="button-hover" id="invite-modal-submit">Submit</button>
          </form>
        </div>
        <div>
          <div id="modal-message" class="text-center"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CONTENT -->
<div class="container">
  {% if current_user.id == user.id %}
  <!-- USER PROFILE -->
  <div>
    <div id="user-name-pencil-container">
      <h2><span class="user-header">{{user.name}}</span></h2>
       <a class="edit-button btn glyphicon glyphicon-pencil btn" href="/users/{{user.id}}/edit"></a>
    </div>
    <div>
      <p>{{user.email}}</p>
      <p>{{user.phone}}</p>
      <p><b>Joined:</b> {{user.created_at.strftime('%m/%y')}}</p>
      <p><b>Admin:</b> {{user.is_admin}}</p>
      <a href="/users/{{user.id}}/editpassword">
      <button class="button-hover">
        Update Password
      </button></a>
      <button type="button" class="button-hover invite-button" data-toggle="modal" data-target="#invite-modal">
        Send Invite
      </button>
    </div>
    <p></p>
    <a href="{{ url_for('users.show_archived',  id=user.id) }}" class="b">
    <button class="button-hover">
      Show Archived Entries
    </button></a>
  </div>

  <!-- USER ENTRIES -->
  <div>
    <h2>Your Entries</h2>
    {% if formatted_entries[0] %} {% for entry in formatted_entries[::-1] %}
      {% if not entry["archived"]%}
      <div class="entrieslist">
          <ul class="entrieslist">
            <div class="entry-post-content"><b>{{entry["content"] | safe }}</b>
                <a href="{{ url_for('users.archive', entry_id=entry['entry_id'], id=user.id) }}" alt="archive" class="button">
                    <i class="fa fa-trash" aria-hidden="true"></i>
                </a>
            </div>
            <p class="entry-post-dates">
              {{entry["created_at"].strftime('%m-%d-%y')}}
            </p>
        </ul>
    </div>
      {% endif %}
    {% endfor %} {% else %}
      <p class="text-center">No posts to show right now</p>
    {% endif %}
  </div>
  {% else %}

  <!-- NON USER PROFILE -->
  <div>
    <h2><span class="user-header">User {{user.name}}</span></h2>
    <div>
      <p>{{user.email}}</p>
      <p>{{user.phone}}</p>
      <p><b>Member Since </b> {{user.created_at.strftime('%m/%y')}}</p>
      <p><b>Last Active</b> {{user.created_at.strftime('%m-%d-%y')}}</p>
    </div>
  </div>

  <!-- NON USER ENTRIES -->
  <div>
    <h3>{{user.name}}'s Entries</h3>
    {% if formatted_entries[0] %} {% for entry in formatted_entries[::-1] %}
    <div class="entry-post">
      <h4 class="entry-post-content">{{entry["content"] | safe }}</h4>
      <p class="entry-post-dates">
        <b>Created On:</b> {{entry["created_at"].strftime('%m-%d-%y')}} at {{entry["created_at"].strftime('%I:%M %p')}}
      </p>
      <p class="entry-post-dates">
        <b>Updated On:</b> {{entry["updated_at"].strftime('%m-%d-%y')}} at {{entry["updated_at"].strftime('%I:%M %p')}}
      </p>
    </div>
    {% endfor %} {% else %}
      <p class="text-center">No posts to show right now</p>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
